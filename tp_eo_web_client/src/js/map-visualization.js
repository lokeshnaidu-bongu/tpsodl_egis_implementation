/*! ElectricOfficeWeb 5.0.1 2021-06-16 */
define(["jquery","underscore","i18n!nls/messages","text!partials/map-visualization.html","map-helper","hogan","comms","map-loader","OpenLayers3","map-core-component/pubsub"],function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l,m=f.compile(d),n="icon-ico_check3_lg",o=function(){a.subscribe("mapInitialised",function(a,b){h.mapVisualization&&p(a,b)})};o();var p=function(a,b){q(b),r(),s()},q=function(a){k=a},r=function(){l=h.mapVisualization.layers},s=function(){j=a('button[data-title="map-visualization"]').parent(),j.append(m.render({items:h.mapVisualization.items})),a(".dropdown-menu li",j).on("click",t),a('li[data-style-id="default"]',j).click()},t=function(){var c=a('button[data-title="map-visualization"]',j);x(),a("#mapVisualization ul li").removeClass("selected"),a(this).addClass("selected");var d=a(this).data("style-id");a("i",a(this)).addClass(n),"default"===d?c.removeClass("btn-selected"):c.addClass("btn-selected"),b.each(e.getMapLayers(),function(a){if(u(a)){var b=w(a),c=b["default"],e=b[d];void 0===e&&c instanceof i.source.WMTS&&(e=new i.source.WMTS({layer:c.getLayer()+"!colour_by!"+d,attributions:c.getAttributions(),url:c.getUrls()[0],matrixSet:c.getMatrixSet(),format:c.getFormat(),projection:c.getProjection().getCode(),tileGrid:c.getTileGrid(),tileLoadFunction:g.customLoader}),v(a,d,e)),a.setSource(e)}})},u=function(a){return a instanceof i.layer.Tile&&b.contains(l,a.get("InternalLayerName"))},v=function(a,b,c){var d=a.get("colourBySources");d[b]=c},w=function(a){var b=a.get("colourBySources");return void 0===b&&(b={"default":a.getSource()},a.set("colourBySources",b)),b},x=function(){a(".dropdown-menu li i",j).removeClass(n)},y={};return y.__TEST_ONLY__={getMap:function(){return k},itemClicked:t,setMap:q,getConfig:function(){return h},getColourByLayerNames:function(){return l}},y});