/*! ElectricOfficeWeb 5.0.1 2021-06-16 */
define(["jquery","underscore","OpenLayers3","i18n!viewer/nls/messages","map-loader","text!overlay-partials/overlay.html","hogan","internals","map-core-component/pubsub","spinner"],function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=g.compile(f),l="overlay",m=function(){a.subscribe("mapInitialised",function(a,b){i=b}),a.subscribe("triggerOverlay",function(a){t(),n(a.content)}),a.subscribe("gotoSidebar",function(b){"object_details"!==b&&a.publish("removeOverlay")}),a.subscribe("removeOverlay",function(a){t()}),a.subscribe("resizeWindow",function(){r()}),a.subscribe("highlightFeatures",function(a,b){a!==l&&p(b)}),a(window).resize(r)},n=function(a){q(),u(a.name||d.internals.title),v(a),o()},o=function(){a.publish("overlayInitialised",[l,j])},p=function(b){w()===h.getWorldDescription()&&a.publish("highlightFeatures",[l,b])},q=function(){var b,c;b=k.render(),a(b).appendTo(a("#mapContainer")),c=a("#overlay"),c.on("shown.bs.modal",function(){r(),a.publish("overlayReady")}),c.on("hidden.bs.modal",function(){a.publish("overlayClosed")})},r=function(){var b,c;c=i?""+i.getSize()[0]:"0",b=""+s(),a(".modal-backdrop").css("width",c),a("#overlayBody").css("height",b)},s=function(){var b,c=0;return a(window)&&(c=a(window).height()),a("#mapContainer")&&(b=a("#mapContainer").offset(),b&&(c+=-b.top)),a(".map-toolbar")&&(c+=-a(".map-toolbar").height()),a("#overlayHeader")&&(c+=-Math.abs(a("#overlayHeader").height())),c},t=function(){var b=a("#overlay"),c=a(".olPopup"),d=a(".modal-backdrop");c&&c.remove(),b&&(b.empty(),b.remove()),d&&d.remove(),a.publish("overlayClosed")},u=function(b){a("#identifer").remove(),a(".modal-header").append('<text id="identifer">'+b+"</text>")},v=function(b){var c;b&&b.getTarget()&&(j=b,c=a("#overlayBody"),c&&(c.empty(),c.append(j.getTarget())))},w=function(){var a,d;return j?(d=b.find(j.getLayers().getArray(),function(b){var d=b.getSource();if(d&&d instanceof c.source.WMTS&&(a=d.getMatrixSet()))return!0}),a):""};m();var x={initialise:n};return x.__TEST_ONLY__={buildUI:q,clearUI:t,initialise:n,getOverlayContent:function(){return j.div},getOverlayBody:function(){return a("#overlayBody")},getOverlay:function(){return a("#overlay")},stubGetWorldDescription:function(a){w=a}},x});