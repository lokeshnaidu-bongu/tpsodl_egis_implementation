/*! ElectricOfficeWeb 5.0.1 2021-06-16 */
define(["jquery","i18n!viewer/nls/messages","comms"],function(a,b,c){"use strict";function d(){function b(){var a=c.getBearerToken();return a?i():f()}var d={dataType:"json",url:"/auth/anonymous",cache:!1};c.getNodeRequest(d,function(d){var f=a.inArray(h(window.location.pathname),d.anonymous_apps)!==-1;c.setStatusOfUnauthentication(f),f?e():b()},function(a,c,d){b()})}var e=function(){a.publish("authCheckComplete")},f=function(){var a="/auth/login?returnTo="+encodeURIComponent(window.location.pathname+window.location.hash);window.location.replace(a)},g=function(){var a="/auth/unauthorized";window.location.replace(a)},h=function(a){var b=a.match(/^\/([^/]+)\//);return b&&b[1]?b[1]:""},i=function(){var d={dataType:"json",url:"/auth/user",cache:!1};c.getNodeRequest(d,function(b){return a.inArray(h(window.location.pathname),b.authorized_apps)<0?g():e()},function(c,d,e){return 401===c.status?f():void a.publish("raiseTempMessage",[b.auth.userInfoError+", http status = "+c.status,{messageType:"warning"}])})},j={redirectToLoginIfNecessary:d};return j.__TEST_ONLY__={getWebAppNamefromPathname:h},j});