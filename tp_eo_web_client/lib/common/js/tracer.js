/*! ElectricOfficeWeb 5.0.1 2021-06-16 */
define(["jquery","underscore","OpenLayers3","map-loader","map-helper","hogan","i18n!nls/messages","map-core-component/pubsub"],function(a,b,c,d,e,f,g){"use strict";var h,i={},j=[0,255,0,.3],k=new c.style.Fill({color:j}),l=new c.style.Stroke({color:j,width:8}),m=new c.style.Circle({fill:k,stroke:l,radius:2}),n=f.compile('<div class="btn-group btn-filter trace-clear" style="padding-right:10px;"><button class="btn btn-map">{{messages.clearTraceButton}} <i class="icon-remove"></i></button></div>'),o=a(".map-toolbar .pull-right"),p={style:new c.style.Style({fill:k,stroke:l,image:m}),source:new c.source.Vector,renderOrder:null,maxResolution:d.MapOptions.MaxResolution,extent:d.MapOptions.MaxExtent},q=function(){a.subscribe("mapInitialised",function(a,b){var d={map:b,layer:new c.layer.Vector(p)};d.layer.name="trace_"+a,i[a]=d}),a.subscribe("traceFeatures",function(a,b){i[a]&&s(i[a],b)}),a.subscribe("clearTrace",function(a){i[a]&&t(i[a])}),a.subscribe("gotoTraceExtent",function(a){i[a]&&r(i[a])})},r=function(a){e.gotoExtentsOfLayer(a.map,a.layer)},s=function(b,c){t(b),b.layer.getSource().addFeatures(c),b.map.addLayer(b.layer),b.map.render();var d=n.render({messages:g});o.length||(o=a(".map-toolbar .trace-actions")),o.prepend(d),h=a(".trace-clear",o),a("button",h).on("click",function(){t(b)})},t=function(a){a.layer.getSource().clear(),h&&h.remove()};q();var u={};return u.__TEST_ONLY__={clearTrace:t,traceFeatures:s,gotoExtents:r,setMapObj:function(a,b){i[b]=a},getMapObj:function(a){return i[a]}},u});